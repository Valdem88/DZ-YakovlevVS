# 3.2. Работа в терминале, лекция 2-Яковлев В.С._ДЗ_7

1. Какого типа команда cd? Попробуйте объяснить, почему она именно такого типа; опишите ход своих мыслей, 
если считаете что она могла бы быть другого типа.

Решение
```bash
~]# type cd
cd — это встроенная команда bash
~]# cd --help
cd: cd [-L|[-P [-e]] [-@]] [каталог]
Change the shell working directory.
```

cd расшифровывается как change directory. 
Команда для изменения рабочего каталога.

2. Какая альтернатива без pipe команде grep <some_string> <some_file> | wc -l? man grep поможет в ответе на этот вопрос. 
Ознакомьтесь с документом о других подобных некорректных вариантах использования pipe.

Решение:

Если нужно узнать количество строк с совпадениями можно использовать `grep <some_string> <some_file> -c`

3. Какой процесс с PID 1 является родителем для всех процессов в вашей виртуальной машине Ubuntu 20.04?

Решение

Команда pstree -p говорит что это systemd
```bash
$ pstree -p
systemd(1)─┬─VBoxService(798)─┬─{VBoxService}(800)
           │                  ├─{VBoxService}(801)
           │                  ├─{VBoxService}(802)
           │                  ├─{VBoxService}(803)
           │                  ├─{VBoxService}(805)
           │                  ├─{VBoxService}(806)
           │                  ├─{VBoxService}(807)
           │                  └─{VBoxService}(808)
           ├─accounts-daemon(577)─┬─{accounts-daemon}(609)
           │                      └─{accounts-daemon}(642)    

```
4. Как будет выглядеть команда, которая перенаправит вывод stderr ls на другую сессию терминала?

Решение

Смотрим номер своего терминала:
```bash 
$ tty
/dev/pts/0
```
Открываем еще один терминал и смотрим его номер:
```bash
$ tty
/dev/pts/2
```
Выводим ошибку в другой терминал:
```bash
$ ls <несуществ директория> 2>/dev/pts/2($ ls proc1 2>/dev/pts/2)
получаем ~]# ls: невозможно получить доступ к 'proc1': Нет такого файла или каталога
```

5. Получится ли одновременно передать команде файл на stdin и вывести ее stdout в другой файл? 
Приведите работающий пример.

Решение

Создаем файлы a.txt и b.txt(останется пустым)
```bash
~]# touch a.txt
``` 
пишем в файле a.txt любой текст
далее
```bash
~]# cat < a.txt > b.txt
```
6. Получится ли находясь в графическом режиме, вывести данные из PTY в какой-либо из эмуляторов TTY? Сможете ли вы наблюдать выводимые данные?

Решение

Вывести получится через перенаправление, но данные не будем видеть. 
Чтобы их увидеть надо перейти в эмулятор терминала с помощью Ctrl + Alt + F1..F6

7. Выполните команду bash 5>&1. К чему она приведет? Что будет, если вы выполните echo netology > /proc/$$/fd/5? Почему так происходит?

Решение

Команда bash 5>&1 создает новый дескриптор 5 и связывает его со стандартным дескриптором вывода. 
Теперь если выполнить echo DevOps-17 > /proc/$$/fd/5 то bash продублирует вывод команды echo на стандартное устройство вывода, 
а не только в файл.

8. Получится ли в качестве входного потока для pipe использовать только stderr команды, не потеряв при этом отображение stdout на pty? Напоминаем: по умолчанию через pipe передается только stdout команды слева от | на stdin команды справа. Это можно сделать, поменяв стандартные потоки местами через промежуточный новый дескриптор, который вы научились создавать в предыдущем вопросе.

Решение (исправлено) 
```bash
 ~]# cat -n file && cat -n file2 55>&2 2>&1 1>&55 | wc -l
     1  1111110     1   999990
```
9. Что выведет команда cat /proc/$$/environ? Как еще можно получить аналогичный по содержанию вывод?

Решение 
```bash
~]# cat /proc/$$/environ
USER=rootLOGNAME=rootHOME=/rootPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/binSHELL=/bin/bashTERM=xtermDISPLAY=localhost:10.0SELINUX_ROLE_REQUESTED=SELINUX_LEVEL_REQUESTED=SELINUX_USE_CURRENT_RANGE=XDG_SESSION_ID=2XDG_RUNTIME_DIR=/run/user/0DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/0/busSSH_CLIENT=192.168.1.76 55681 22SSH_CONNECTION=192.168.1.76 55681 192.168.1.22 22SSH_TTY=/dev/pts/0[root@Git-SentOS-8 ~]#
```
Эта команда эквивалентна команде env без аргументов и выводит список переменных окружения и их значений.

10. Используя man, опишите что доступно по адресам /proc/<PID>/cmdline, proc/<PID>/exe.

Решение 

`/proc/<PID>/cmdline`

  Этот файл содержит полную командную строку запуска процесса, кроме тех процессов, что полностью ушли в своппинг, а также тех, что превратились в зомби. В этих двух случаях в файле ничего нет, то есть чтение этого файла вернет 0 символов. Аргументы командной строки в этом файле указаны как список строк, каждая из которых завешается нулевым символом, с добавочным нулевым байтом после последней строки.

`/proc/<PID>/exe`
  
Под Linux 2.2 и 2.4 exe является символьной ссылкой, содержащей фактическое полное имя выполняемого файла. Символьная ссылка exe может использоваться обычным образом - при попытке открыть exe будет открыт исполняемый файл. Вы можете даже ввести /proc/[number]/exe чтобы запустить другую копию процесса такого же как и процесс с номером [число].
Под Linux 2.0 и в более ранних версиях exe является указателем на запущенный файл и является символьной ссылкой. Вызов readlink(2) на этот специальный файл exe под Linux 2.0 и более ранних версий возвращает строку формата:

`[устройство]:индексный_дескриптор`

11. Узнайте, какую наиболее старшую версию набора инструкций SSE поддерживает ваш процессор с помощью /proc/cpuinfo.

Решение
```bash
~]# grep sse /proc/cpuinfo
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt rdtscp lm constant_tsc rep_good nopl nonstop_tsc cpuid extd_apicid tsc_known_freq pni pclmulqdq monitor ssse3 cx16 sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx rdrand hypervisor lahf_lm cr8_legacy abm sse4a misalignsse 3dnowprefetch ssbd vmmcall fsgsbase avx2 rdseed clflushopt arat
```
12. При открытии нового окна терминала и vagrant ssh создается новая сессия и выделяется pty. Это можно подтвердить командой tty, которая упоминалась в лекции 3.2. Однако:
```bash
vagrant@netology1:~$ ssh localhost 'tty'
not a tty
```
Почитайте, почему так происходит, и как изменить поведение.

Решение

При отправке команд по ssh псевдотерминал по умолчанию не создаётся, поэтому получаем такую ошибку. Принудительно создать tty можно ключом -t, в таком случае команда создает tty и показывает его номер:
```bash
~$ ssh -t localhost tty
vagrant@localhost's password:
/dev/pts/3
Connection to localhost closed.
```
13. Бывает, что есть необходимость переместить запущенный процесс из одной сессии в другую. Попробуйте сделать это, воспользовавшись reptyr. Например, так можно перенести в screen процесс, который вы запустили по ошибке в обычной SSH-сессии.

Решение 

Получилось сделать по этой инструкции 
https://github.com/nelhage/reptyr#readme

14. sudo echo string > /root/new_file не даст выполнить перенаправление под обычным пользователем, так как перенаправлением занимается процесс shell'а, который запущен без sudo под вашим пользователем. Для решения данной проблемы можно использовать конструкцию echo string | sudo tee /root/new_file. Узнайте что делает команда tee и почему в отличие от sudo echo команда с sudo tee будет работать.

Решение 

команда tee читает из input делее пишет в output и в файл, выполняется потому что запущена от sudo.


